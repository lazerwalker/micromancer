(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{100:function(e,t,n){},101:function(e,t,n){},102:function(e,t,n){"use strict";n.r(t);var r,i=n(0),o=n.n(i),a=n(32),s=n.n(a),d=(n(40),n(4)),c=n(5),u=n(7),l=n(6),p=n(8),m=(n(41),n(33)),f=n(34),b=n(3),h=n.n(b);!function(e){e[e.Debug=0]="Debug",e[e.Editor=1]="Editor"}(r||(r={}));var v,g,O=function(e){for(var t=[],n=0;n<10;n++)t.push([]);return Object(f.a)({code:t,cursor:{line:0,token:0,isMidOperand:!1},memory:[],warriors:[],isPlaying:!1,debugTicks:0,nextPC:0,uiMode:r.Editor,editingCode:[],viewingOwnCode:!0},e)},y=["\ud83c\udfc1","\ud83d\udc9c","\ud83d\udd25","\ud83e\udd51","\ud83d\udca9","\ud83d\udc08"],M=["start","love","flame","avo","poop","cat"];function k(e){return[].concat(Object(m.a)(e.split("\n").map(function(e){var t=e.split(" ");return h.a.includes(y,t[0])||t.unshift(void 0),t})),[[void 0,void 0,void 0,void 0]])}!function(e){e[e.Label=0]="Label",e[e.Opcode=1]="Opcode",e[e.Operand1=2]="Operand1",e[e.Operand2=3]="Operand2"}(v||(v={})),function(e){e[e.Immediate=0]="Immediate",e[e.Direct=1]="Direct",e[e.Indirect=2]="Indirect",e[e.Autodecrement=3]="Autodecrement"}(g||(g={}));var w,D,S,E={$:g.Direct,"#":g.Immediate,"@":g.Indirect,">":g.Autodecrement,"":g.Direct};function A(e){return h.a.invert(E)[e]||""}function P(e){return E[e]}!function(e){e[e.DAT=0]="DAT",e[e.MOV=1]="MOV",e[e.ADD=2]="ADD",e[e.SUB=3]="SUB",e[e.JMZ=4]="JMZ",e[e.JMN=5]="JMN",e[e.JMP=6]="JMP",e[e.DJN=7]="DJN",e[e.CMP=8]="CMP",e[e.SLT=9]="SLT",e[e.SPL=10]="SPL",e[e.EQU=11]="EQU",e[e.END=12]="END"}(w||(w={})),function(e){e[e.Add=0]="Add",e[e.Divide=1]="Divide",e[e.Subtract=2]="Subtract",e[e.Multiply=3]="Multiply"}(D||(D={})),function(e){e[e.NextWord=0]="NextWord",e[e.TypeOpcode=1]="TypeOpcode",e[e.TypeOperandDigit=2]="TypeOperandDigit",e[e.TypeOperandMode=3]="TypeOperandMode",e[e.TypeOperandLabel=4]="TypeOperandLabel",e[e.SetCursor=5]="SetCursor",e[e.Backspace=6]="Backspace",e[e.DebugRestart=7]="DebugRestart",e[e.DebugUndo=8]="DebugUndo",e[e.DebugPauseOrStep=9]="DebugPauseOrStep",e[e.DebugPlay=10]="DebugPlay",e[e.DebugFast=11]="DebugFast",e[e.DebugTick=12]="DebugTick",e[e.SwitchToDebug=13]="SwitchToDebug",e[e.SwitchToEditor=14]="SwitchToEditor",e[e.ToggleWhoseCode=15]="ToggleWhoseCode"}(S||(S={}));var C=function(e){return{type:S.TypeOpcode,value:e}},T=function(e){return{type:S.TypeOperandMode,value:A(e)}},j=function(e){return{type:S.TypeOperandDigit,value:e.toString()}},x=function(e){return{type:S.TypeOperandLabel,value:e.toString()}},F=function(){return{type:S.NextWord,value:void 0}},I=function(e,t){return{type:S.SetCursor,value:{line:e,token:t,isMidOperand:!1}}},N=function(){return{type:S.Backspace,value:void 0}},J=function(){return{type:S.DebugRestart,value:void 0}},L=function(){return{type:S.DebugUndo,value:void 0}},U=function(){return{type:S.DebugPauseOrStep,value:void 0}},B=function(){return{type:S.DebugPlay,value:void 0}},V=function(){return{type:S.DebugFast,value:void 0}},_=function(){return{type:S.SwitchToDebug,value:void 0}},W=function(){return{type:S.SwitchToEditor,value:void 0}},z=function(){return{type:S.ToggleWhoseCode,value:void 0}},R=n(9),K=[{name:"Leave no trace",testWinCondition:function(e,t){return e.filter(function(e){return e.opcode===R.Opcode.DAT&&e.aMode===R.AddressingMode.Direct&&999===e.aField&&999===e.bField&&e.bMode===R.AddressingMode.Direct}).length===e.length}}];n(98);var Z=function(e){function t(){var e,n;Object(d.a)(this,t);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(n=Object(u.a)(this,(e=Object(l.a)(t)).call.apply(e,[this].concat(i)))).restart=function(){n.props.dispatch(J())},n.undo=function(){n.props.dispatch(L())},n.pauseOrStep=function(){n.props.dispatch(U())},n.play=function(){n.props.dispatch(B())},n.fast=function(){n.props.dispatch(V())},n}return Object(p.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return i.createElement("div",{className:"debug-toolbar",style:{textAlign:"center"}},i.createElement("button",{onClick:this.restart},this.props.isAtStart?"Reset":"Stop"),i.createElement("button",{onClick:this.undo},"Undo"),i.createElement("button",{onClick:this.pauseOrStep},this.props.isPaused?"Step":"Pause"),i.createElement("button",{onClick:this.play},"Run"),i.createElement("button",{onClick:this.fast},"Fast"))}}]),t}(i.Component),Q=n(13),q=n.n(Q),Y=n(12);function $(e){var t=e.owner,n=e.isPC,r=e.isNext,o=e.instruction,a=q()({"memory-cell":!0,"warrior-1":0===t,"warrior-2":1===t,pc:n,next:r}),s=[Object(Y.printOpcode)(o),Object(Y.printOperandA)(o),Object(Y.printOperandB)(o)];o.label&&s.unshift(o.label);var d=s.map(function(e){for(var t=0;t<y.length;t++)e=e.replace(M[t],y[t]);return e}).map(function(e){return i.createElement("div",null,e)});return i.createElement("div",{className:a},d)}n(99);var G=function(e){function t(){return Object(d.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this,t=this.props.memory.map(function(t,n){var r=!!e.props.warriors.find(function(e){return h.a.includes(e.pc,n)}),o=n===e.props.nextPC;return i.createElement($,{owner:t.owner,isPC:r,isNext:o,key:"memory-".concat(n),instruction:t})});return i.createElement("div",{className:"memory-view"},t)}}]),t}(i.Component),H=(n(100),function(e){function t(){var e,n;Object(d.a)(this,t);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(n=Object(u.a)(this,(e=Object(l.a)(t)).call.apply(e,[this].concat(i)))).switchToEditor=function(){n.props.dispatch(W())},n}return Object(p.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return i.createElement("div",{className:"debug"},i.createElement(G,{memory:this.props.memory,warriors:this.props.warriors,nextPC:this.props.nextPC}),i.createElement("button",{onClick:this.switchToEditor,id:"show-editor"},"edit"),i.createElement("div",{id:"logo"},"omega"),i.createElement(Z,{dispatch:this.props.dispatch,isAtStart:this.props.isAtStart,isPaused:this.props.isPaused}))}}]),t}(i.Component)),X=function(e){var t=0,n=function(n){return"spacer"===n?(t+=1,i.createElement("div",{className:"spacer",key:"spacer-".concat(t)})):i.createElement("button",{key:"key-".concat(n),className:"opcode",onClick:function(){return e.onKeyPress(n)}},n)},r=[["DAT","MOV","spacer","ADD","SUB","spacer","SPL"],["JMZ","JMN","JMP"],["DJN","CMP","SLT"]].map(function(e,t){var r=e.map(n);return i.createElement("div",{className:"opcode-row",key:"opcode-row-".concat(t)},r)});return i.createElement("div",{className:"opcode keyboard"},i.createElement("div",{className:"opcodes"},r),i.createElement("button",{key:"next",id:"next-key",onClick:e.onNext},"space"),i.createElement("button",{key:"backspace",id:"backspace-key",onClick:e.onBackspace},"del"))},ee=function(e){var t,n=[1,2,3,4,5,6,7,8,9,0].map(function(t){return i.createElement("button",{key:"key-".concat(t),id:"numkey-".concat(t),className:"number",onClick:function(){return e.onKeyPress(t.toString())}},t)});return t=e.canAddAddressingMode?["#","@",">","-"].map(function(t){return i.createElement("button",{key:"key-".concat(t),className:"addressingMode",disabled:!e.canAddAddressingMode,onClick:function(){return e.onKeyPress(t.toString())}},t)}):["/","*","+","-"].map(function(t){return i.createElement("button",{key:"key-".concat(t),className:"addressingMode",disabled:"-"!==t&&e.canAddAddressingMode,onClick:function(){return e.onKeyPress(t)}},t)}),i.createElement("div",{className:"keyboard number"},i.createElement("div",{className:"leftKeys"},t),i.createElement("div",{className:"numbers"},n),i.createElement("button",{key:"done",id:"next-key",disabled:!e.canNext,onClick:function(){return e.onNext()}},e.isEndOfLine?"return":","),i.createElement("button",{key:"backspace",id:"backspace-key",onClick:function(){return e.onBackspace()}},"del"))},te=function(e){var t=y.map(function(t){return i.createElement("button",{key:"key-".concat(t),id:"emojikey-".concat(t),className:"emoji",onClick:function(){return e.onKeyPress(t)}},t)});return i.createElement("div",{id:"emoji-bar"},t)};function ne(e){if(void 0===e.cursor.token)return!0;var t=e.code[e.cursor.line][e.cursor.token];return!!t&&function(e){var t=function(e){return parseInt(e).toString()===e},n=function(e){return!(!t(e[0])&&"-"!==e[0])&&!!t(e[e.length-1])};if(t(e)||n(e))return!0;if(P(e[0])){var r=e.slice(1);return t(r)||n(r)}return!0}(t)}var re="#012849",ie="#a9bed8",oe={color1:"#918988",color2:"#f579b2",color3:"#bbee78",color4:"#f5b378",color5:"#81b3ec",color6:"#bb79ec",color7:"#81eeb2",color8:"#f5eeec"},ae=(n(101),function(e){var t=e.code.map(function(t,n){var r=n===e.currentLine&&void 0===e.currentToken,o=t.map(function(t,o){var a=n===e.currentLine&&o===e.currentToken,s=q()("token",{label:0===o,opcode:1===o,"operand-1":2===o,"operand-2":3===o,selected:a,operand:o>1,empty:h.a.isUndefined(t)}),d={};return d.color=oe.color1,(a||r)&&(d.backgroundColor=ie,d.color=re),i.createElement("span",{className:s,key:"token-".concat(n,"-").concat(o),onClick:function(t){e.onTokenClick&&e.onTokenClick(n,o),t.stopPropagation()},style:d},t)}),a=q()("code-line",{"current-line":n===e.currentLine});return i.createElement("div",{className:a,key:"line-".concat(n),onClick:function(){return e.onLineClick&&e.onLineClick(n)},style:{backgroundColor:r?ie:re,color:ie}},i.createElement("span",{className:"line-num relative",style:{backgroundColor:oe.color1}},n-e.currentLine),i.createElement("span",{className:"code-instruction"},o))});return i.createElement("div",{className:"container"},i.createElement("div",{className:"code-box crt",style:{background:"linear-gradient(to right, ".concat(oe.color1," 40px, ").concat(re," 40px)")}},t))}),se=function(e){function t(){var e,n;Object(d.a)(this,t);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(n=Object(u.a)(this,(e=Object(l.a)(t)).call.apply(e,[this].concat(i)))).switchToDebug=function(){n.codeIsValid()&&n.props.dispatch(_())},n.showOtherCode=function(){n.props.dispatch(z())},n.clickLine=function(e){n.props.dispatch(I(e,void 0))},n.clickToken=function(e,t){console.log("Click token"),n.props.dispatch(I(e,t))},n.typeOpcode=function(e){n.props.dispatch(C(e))},n.typeDigitOrMode=function(e){var t;t=parseInt(e,10).toString()===e?j(parseInt(e)):h.a.isUndefined(P(e))?x(e):T(P(e)),n.props.dispatch(t)},n.next=function(){n.props.dispatch(F())},n.didTypeBackspace=function(){n.props.dispatch(N())},n.codeIsValid=function(){return!n.props.code.filter(function(e){return e.filter(function(e){return void 0!==e}).length>0}).find(function(e){return e.length>0&&h.a.isUndefined(e[1])||h.a.isUndefined(e[2])})},n}return Object(p.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e,t=this.props,n=t.cursor,r=t.code,o=t.isOwnCode;n.token===v.Opcode||void 0===n.token?e=i.createElement(X,{onKeyPress:this.typeOpcode,onNext:this.next,onBackspace:this.didTypeBackspace}):n.token!==v.Operand1&&n.token!==v.Operand2||(e=i.createElement(ee,{onKeyPress:this.typeDigitOrMode,onBackspace:this.didTypeBackspace,onNext:this.next,canAddAddressingMode:!n.isMidOperand,canNext:ne(this.props),isEndOfLine:n.token===v.Operand2}));var a=void 0;this.props.enemyCodeExists&&(a=i.createElement("button",{onClick:this.showOtherCode,id:"show-other"},o?"enemy code":"my code"));var s=this.codeIsValid(),d=i.createElement(te,{onKeyPress:this.typeDigitOrMode});return i.createElement("div",{className:"editor"},i.createElement(ae,{code:r,currentLine:n.line,currentToken:n.token,onLineClick:this.clickLine,onTokenClick:this.clickToken}),i.createElement("button",{onClick:this.switchToDebug,className:s?"":"disabled",id:"show-debug"},"debug"),a,i.createElement("div",{id:"logo"},"omega"),o?d:void 0,o?e:void 0)}}]),t}(i.Component),de=function(e){function t(e){var n;Object(d.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state=void 0,n.reducer=void 0,n.timer=void 0,n.dispatch=function(e){console.log("Dispatching",e),n.setState(n.reducer(n.state,e))};var i=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:80,i=[],o=function(e){console.log(e),console.log("---"),console.log(t);var n=[e];void 0!==t&&n.push(t),i=n.map(function(e){for(var t=0;t<y.length;t++)e=e.replace(y[t],M[t]);return e}).map(R.parse)};o(e);var a,s=new R.VM(h.a.cloneDeep(i),n),d=k(e);void 0!==t&&(a=k(t));var c=O({code:d,enemyCode:a,editingCode:d,viewingOwnCode:!0,memory:s.memory,warriors:s.warriors,debugStartPositions:s.warriors.map(function(e){return e.pc[0]}),nextPC:s.warriors[0].pc[0],activeLevel:K[0]});return console.log(s.equs),{state:c,reducer:function e(t,d){var c=h.a.cloneDeep(t),u=c.cursor,l=c.code,p=l[u.line]||[];if(d.type===S.TypeOpcode)return u.token!==v.Opcode?t:(void 0===u.token?c.code[u.line]=[d.value]:p[v.Opcode]=d.value,u.token+=1,u.isMidOperand=!1,c);if(d.type===S.TypeOperandDigit)return u.token!==v.Operand1&&u.token!==v.Operand2?t:p?(u.isMidOperand?p[u.token]=(p[u.token]||"")+d.value:(p[u.token]=d.value,u.isMidOperand=!0),c):t;if(d.type===S.TypeOperandLabel)return void 0===u.token?t:p?(u.token===v.Label||u.token===v.Opcode?p[v.Label]===d.value?p[v.Label]=void 0:p[v.Label]=d.value:("-"!==d.value||u.isMidOperand)&&u.isMidOperand?(p[u.token]=(p[u.token]||"")+d.value,u.isMidOperand=!0):(p[u.token]=d.value,u.isMidOperand=!0),c):t;if(d.type===S.TypeOperandMode)return u.token!==v.Operand1&&u.token!==v.Operand2?t:p?u.isMidOperand?t:(p[u.token]=d.value,u.isMidOperand=!0,c):t;if(d.type===S.NextWord){if(u.isMidOperand=!1,void 0===u.token)return u.line=u.line+1,l[u.line]||l.push([void 0,void 0,void 0,void 0]),l[u.line+1]||l.push([void 0,void 0,void 0,void 0]),c;if(p[u.token]){if(u.token===v.Operand1)return p[u.token]+=",",u.token=v.Operand2,c;if(u.token===v.Operand2)return u.token=v.Opcode,u.line=u.line+1,l[u.line]||l.push([void 0,void 0,void 0,void 0]),l[u.line+1]||l.push([void 0,void 0,void 0,void 0]),c}return t}if(d.type===S.SetCursor)return c.cursor=d.value,c;if(d.type===S.Backspace){if(void 0===u.token)return c.code.splice(u.line,1),u.line>0&&(u.line-=1),c;var m=p[u.token];return u.token===v.Opcode?(u.line>0&&(u.line-=1,u.token=v.Operand2),p[u.token]=void 0,c):(m&&u.isMidOperand&&m.length>1?p[u.token]=m.slice(0,m.length-1):(p[u.token]=void 0,u.token-=1),c)}if(d.type===S.DebugRestart)return c.isPlaying=!1,0===t.debugTicks?(s=new R.VM(h.a.cloneDeep(i),n),c.memory=s.memory,c.warriors=s.warriors,c.debugTicks=0,c.debugStartPositions=s.warriors.map(function(e){return e.pc[0]}),c.nextPC=s.warriors[0].pc[0]):(s=new R.VM(h.a.cloneDeep(i),n,void 0,c.debugStartPositions),c.memory=s.memory,c.warriors=s.warriors,c.winner=void 0,c.debugTicks=0,c.nextPC=s.warriors[0].pc[0]),c;if(d.type===S.DebugUndo){s=new R.VM(h.a.cloneDeep(i),n,void 0,c.debugStartPositions);for(var f=0,b=0;b<t.debugTicks-1;b++)f=s.tick()||f;return c.memory=s.memory,c.warriors=s.warriors,c.winner=void 0,c.debugTicks=t.debugTicks-1,c.nextPC=f,c}if(d.type===S.DebugPauseOrStep){if(c.isPlaying)return c.isPlaying=!1,c;if(!h.a.isUndefined(t.winner))return console.log("Can't continue, game is over"),t;var g=s.tick();if(h.a.isUndefined(g)){c.winner=h.a.indexOf(s.warriors,s.winner()),c.isPlaying=!1;var O=0===c.winner;return alert(O?"You won!":"You lost."),c}return c.nextPC=g,console.log(s.print()),c.activeLevel&&c.activeLevel.testWinCondition(s.memory,s.warriors)&&(alert("WIN CONDITION MET"),c.isPlaying=!1),c.debugTicks+=1,c.memory=s.memory,c.warriors=s.warriors,c}if(d.type===S.DebugTick){if(!c.isPlaying)return t;if(!h.a.isUndefined(t.winner))return console.log("Can't continue, game is over"),t;var y=s.tick();if(h.a.isUndefined(y)){c.winner=h.a.indexOf(s.warriors,s.winner()),c.isPlaying=!1;var M=0===c.winner;return alert(M?"You won!":"You lost."),c}return c.nextPC=y,c.debugTicks+=1,c.memory=s.memory,c.warriors=s.warriors,c}return d.type===S.DebugPlay?(c.isPlaying=!0,c.playRate=100,c):d.type===S.DebugFast?(c.isPlaying=!0,c.playRate=5,c):d.type===S.SwitchToDebug?(o(function(e){return e.map(function(e){return e.join(" ")}).join("\n")}(t.code)),c.uiMode=r.Debug,e(c,J())):d.type===S.SwitchToEditor?(c.uiMode=r.Editor,c):d.type===S.ToggleWhoseCode?(c.viewingOwnCode&&void 0!==a?c.editingCode=a:c.editingCode=c.code,c.cursor={line:0,token:0,isMidOperand:!1},c.viewingOwnCode=!c.viewingOwnCode,c):t}}}("MOV 0, 1",void 0),o=i.state,a=i.reducer;return n.state=o,n.reducer=a,n}return Object(p.a)(t,e),Object(c.a)(t,[{key:"componentDidUpdate",value:function(){var e=this;if(this.state.isPlaying&&!this.timer){!function t(){e.dispatch({type:S.DebugTick,value:void 0}),e.state.isPlaying&&e.state.playRate?e.timer=setTimeout(t,e.state.playRate):e.timer=void 0}()}}},{key:"render",value:function(){return this.state.uiMode===r.Editor?o.a.createElement(se,{dispatch:this.dispatch,code:this.state.editingCode,cursor:this.state.cursor,isOwnCode:this.state.viewingOwnCode,enemyCodeExists:void 0!==this.state.enemyCode}):this.state.uiMode===r.Debug?o.a.createElement(H,{code:this.state.code,dispatch:this.dispatch,memory:this.state.memory,warriors:this.state.warriors,nextPC:this.state.nextPC,isPaused:!this.state.isPlaying,isAtStart:0===this.state.debugTicks}):(console.log("Unknown UI mode: ".concat(this.state.uiMode)),o.a.createElement("div",null))}}]),t}(o.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));s.a.render(o.a.createElement(de,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})},12:function(e,t,n){"use strict";var r=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e};Object.defineProperty(t,"__esModule",{value:!0});var i=n(18),o=n(97),a=function(){function e(e,t,n,r){void 0===t&&(t=8e3),this.cycles=0,this.nextProgramIndex=0,this.labels={},this.equs={},this.memory=[],this.warriors=[],this.programs=e,this.size=t,this.cycleLimit=n;for(var o,a={opcode:i.Opcode.DAT,aMode:i.AddressingMode.Immediate,aField:0,bMode:i.AddressingMode.Immediate,bField:0},d=0;d<t;d++)this.memory[d]=Object.assign({},a);if(r&&r.length===e.length)o=r;else{var c=this.findStartPositions(e,t);if(null===c)return void console.log("Could not assign positions");o=c}var u=[];for(d=0;d<e.length;d++){var l=e[d],p=o[d];u[d]=0;for(var m=0,f=0;f<l.length;f++){var b=s(p+f+m,t),h=l[f];if(h.owner=d,h.opcode===i.Opcode.END){h.aField&&this.labels[h.aField]&&(o[d]=this.labels[h.aField]);break}h.opcode!==i.Opcode.EQU?(this.memory[b]=h,h.label&&(this.labels[h.label]=b),"start"===h.label&&(u[d]=b-p)):(h.label&&(this.equs[h.label]=h.aField),m-=1)}}this.warriors=o.map(function(e,t){return{number:t,pc:[e+u[t]]}})}return e.prototype.tick=function(){var e=this.warriors[this.nextProgramIndex];if(e)if(this.execute(e),0!==e.pc.length){if(this.cycles++,!(this.cycleLimit&&this.cycles>this.cycleLimit))return this.nextProgramIndex+=1,this.nextProgramIndex>=this.warriors.length&&(this.nextProgramIndex=0),this.warriors[this.nextProgramIndex].pc[0];console.log("Game over: draw!")}else console.log("Game over: player "+e.number+" bombed!");else console.log("Warning: couldn't execute program")},e.prototype.winner=function(){var e=this.warriors.filter(function(e){return e.pc.length>0});if(1===e.length)return e[0]},e.prototype.print=function(){var e=[];e.push("CYCLE "+this.cycles);for(var t=0,n=this.warriors;t<n.length;t++){var r=n[t];e.push("Process Queue: ["+r.pc+"]");for(var i=-5;i<15;i++){var o=s(r.pc[0]+i,this.size),a=o+": "+d(this.memory[o]);0===i&&(a+=" <-- "+r.number),e.push(a)}}return e.push(""),e.join("\n")},e.prototype.findStartPositions=function(e,t){var n=o.flatten(e).length,r=Math.floor((t-n)/2),i=o.random(0,t);return e.map(function(e,n){return(i+n*r)%t})},e.prototype.execute=function(e){var t=e.pc.shift(),n=this.memory[t],o=n.opcode,a=n.aMode,d=n.aField,c=n.bMode,u=n.bField,l=this.evaluateOperand(t,a,d,this.size),p=this.evaluateOperand(t,c,u,this.size),m=this.memory[l],f=this.memory[p];n.owner=e.number;var b=!0;switch(o){case i.Opcode.ADD:if(c===i.AddressingMode.Immediate)return;a===i.AddressingMode.Immediate?(f.bField=s(this.evaluateField(p,f.bField)+l,this.size),f.owner=e.number):(f.aField=s(this.evaluateField(p,f.aField)+l,this.size),f.bField=s(this.evaluateField(p,f.bField)+p,this.size),f.owner=e.number);break;case i.Opcode.CMP:a===i.AddressingMode.Immediate?d===f.bField&&(e.pc.push(t+2),b=!1):m===f&&(e.pc.push(t+2),b=!1);break;case i.Opcode.DAT:b=!1;break;case i.Opcode.DJN:if(c===i.AddressingMode.Immediate)break;f.bField=this.evaluateField(p,f.bField)-1,f.owner=e.number,0===f.bField&&a!=i.AddressingMode.Immediate&&(e.pc.push(m.aField),b=!1);break;case i.Opcode.MOV:a===i.AddressingMode.Immediate||c===i.AddressingMode.Immediate?(f.bField=l,f.owner=e.number):(this.memory[p]=r({},m),m.label&&(this.labels[m.label]=p));break;case i.Opcode.JMP:if(a===i.AddressingMode.Immediate)break;e.pc.push(l),b=!1;break;case i.Opcode.JMZ:if(a===i.AddressingMode.Immediate)break;0===f.bField&&(e.pc.push(l),b=!1);break;case i.Opcode.JMZ:if(a===i.AddressingMode.Immediate)break;0!==f.bField&&(e.pc.push(l),b=!1);break;case i.Opcode.SPL:if(a===i.AddressingMode.Immediate)break;e.pc.push(t+1),e.pc.push(l),b=!1;break;case i.Opcode.SLT:if(c===i.AddressingMode.Immediate)break;(a===i.AddressingMode.Immediate?d:m.aField)<f.bField&&(e.pc.push(t+2),b=!1);break;case i.Opcode.SUB:if(c===i.AddressingMode.Immediate)return;a===i.AddressingMode.Immediate?(f.bField=s(this.evaluateField(p,f.bField)-l,this.size),f.owner=e.number):(f.aField=s(this.evaluateField(p,f.aField)-l,this.size),f.bField=s(this.evaluateField(p,f.bField)-p,this.size),f.owner=e.number)}b&&e.pc.push(s(t+1,this.size))},e.prototype.evaluateOperand=function(e,t,n,r){if("number"===typeof n){if(t===i.AddressingMode.Immediate)return n;var o=s(n+e,r);if(t===i.AddressingMode.Direct)return o;var a=this.evaluateField(o,this.memory[o].bField);return t===i.AddressingMode.Autodecrement&&(a-=1,this.memory[o].bField=a),s(o+=a,this.size)}var d=this.evaluateField(e,n);return this.evaluateOperand(e,t,d,r)},e.prototype.evaluateField=function(e,t){if("number"===typeof t)return t;if(void 0!==t.operator){var n=this.evaluateField(e,t.left),r=this.evaluateField(e,t.right);if(o.isUndefined(n)||o.isUndefined(r))return-1;switch(t.operator){case i.MathOperator.Add:return n+r;case i.MathOperator.Subtract:return n-r;case i.MathOperator.Multiply:return n*r;case i.MathOperator.Divide:return n/r}return-1}return"string"===typeof t?void 0!=this.labels[t]?this.labels[t]-e:void 0!=this.equs[t]?this.equs[t]:(console.log("FATAL ERROR: could not find label '"+t+"'"),-1):-1},e}();function s(e,t){for(var n=e;n<0;)n=t+n;return n%t}function d(e){var n=t.printOpcode(e)+" "+t.printOperandA(e)+", "+t.printOperandB(e);return e.label?e.label+" "+n:n}t.VM=a,t.printInstruction=d,t.printOpcode=function(e){return i.Opcode[e.opcode]},t.printOperand=function(e,t){return""+function(e){switch(e){case i.AddressingMode.Direct:return"";case i.AddressingMode.Immediate:return"#";case i.AddressingMode.Indirect:return"@";case i.AddressingMode.Autodecrement:return">"}}(e)+c(t)},t.printOperandA=function(e){return t.printOperand(e.aMode,e.aField)},t.printOperandB=function(e){return t.printOperand(e.bMode,e.bField)};var c=function e(t){return"string"==typeof t?t:"number"==typeof t?""+t:""+e(t.left)+function(e){switch(e){case i.MathOperator.Add:return"+";case i.MathOperator.Subtract:return"-";case i.MathOperator.Multiply:return"*";case i.MathOperator.Divide:return"/"}}(t.operator)+e(t.right)}},18:function(e,t,n){"use strict";var r,i;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.Direct=0]="Direct",e[e.Immediate=1]="Immediate",e[e.Indirect=2]="Indirect",e[e.Autodecrement=3]="Autodecrement"}(r=t.AddressingMode||(t.AddressingMode={})),function(e){e[e.DAT=0]="DAT",e[e.MOV=1]="MOV",e[e.ADD=2]="ADD",e[e.SUB=3]="SUB",e[e.JMZ=4]="JMZ",e[e.JMN=5]="JMN",e[e.JMP=6]="JMP",e[e.DJN=7]="DJN",e[e.CMP=8]="CMP",e[e.SPL=9]="SPL",e[e.SLT=10]="SLT",e[e.EQU=11]="EQU",e[e.END=12]="END"}(i=t.Opcode||(t.Opcode={})),function(e){e[e.Add=0]="Add",e[e.Divide=1]="Divide",e[e.Subtract=2]="Subtract",e[e.Multiply=3]="Multiply"}(t.MathOperator||(t.MathOperator={})),t.instructionToString=function(e){var t,n=e.label,o=e.opcode,a=e.aMode,s=e.aField,d=e.bMode,c=e.bField,u=((t={})[r.Direct]="",t[r.Immediate]="#",t[r.Indirect]="@",t[r.Autodecrement]="<",t),l=i[o]+" "+u[a]+s+", "+u[d]+" "+c;return n&&(l=n+" "+l),l}},35:function(e,t,n){e.exports=n(102)},40:function(e,t,n){},41:function(e,t,n){},42:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(18),i=n(14);t.grammar=i.grammar('\nProgram {\n\n  Program = Instruction+\n  \n  Instruction \n   = label opcode Operand ("," Operand)? comment? -- label\n   | opcode Operand ("," Operand)? comment? -- nolabel\n   | comment -- commentonly\n  \n  label\n      = word\n  \n  opcode\n      = "DAT"\n      | "MOV"\n      | "ADD"\n      | "SUB"\n      | "JMZ"\n      | "JMN"\n      | "JMP"\n      | "DJN"\n      | "CMP"\n      | "SPL"\n      | "SLT"\n      | "EQU"\n      | "END"\n      | "dat"\n      | "mov"\n      | "add"\n      | "sub"\n      | "jmz"\n      | "jmn"\n      | "jmp"\n      | "djn"\n      | "cmp"\n      | "spl"\n      | "slt"\n      | "equ"\n      | "end"    \n  \n  \n  Operand\n      = addressingMode? OperandValue\n  \n  OperandValue = AddExp | OperandValue\n  \n  AddExp\n      = AddExp "+" MulExp  -- plus\n      | AddExp "-" MulExp  -- minus\n      | MulExp\n  \n  MulExp\n      = MulExp "*" operandLiteral  -- times\n      | MulExp "/" operandLiteral  -- divide\n      | operandLiteral\n  \n  operandLiteral = number | label\n  \n  addressingMode = "$" | "#" | "@" | "<"\n  \n  comment = ";" (~lineTerminator any)*\n  \n  word = alnum+\n  \n  number = "-"? digit+\n  \n  lineTerminator = "\\n" | "\\r" | "\\u2028" | "\\u2029"\n  \n  }'),t.semantics=t.grammar.createSemantics(),t.parse=function(e){var n=t.grammar.match(e);return t.semantics(n).asMarsJSObject()},t.semantics.addOperation("asMarsJSObject",{Program:function(e){return e.children.map(function(e){return e.asMarsJSObject()}).filter(function(e){return void 0!=e})},Instruction_label:function(e,t,n,i,o,a){var s=n.asMarsJSObject(),d=o.asMarsJSObject()[0]||{addressingMode:r.AddressingMode.Direct,field:0},c={label:e.asMarsJSObject(),opcode:t.asMarsJSObject(),aMode:s.addressingMode,aField:s.field,bMode:d.addressingMode,bField:d.field},u=a.asMarsJSObject()[0];return u&&(c.comment=u),c},Instruction_nolabel:function(e,t,n,i,o){var a=t.asMarsJSObject(),s=i.asMarsJSObject()[0]||{addressingMode:r.AddressingMode.Direct,field:0},d={opcode:e.asMarsJSObject(),aMode:a.addressingMode,aField:a.field,bMode:s.addressingMode,bField:s.field},c=o.asMarsJSObject()[0];return c&&(d.comment=c),d},Instruction_commentonly:function(e){},Operand:function(e,t){return{addressingMode:{$:r.AddressingMode.Direct,"#":r.AddressingMode.Immediate,"@":r.AddressingMode.Indirect,"<":r.AddressingMode.Autodecrement,"":r.AddressingMode.Direct}[e.sourceString],field:t.asMarsJSObject()}},OperandValue:function(e){return e.asMarsJSObject()},AddExp:function(e){return e.asMarsJSObject()},AddExp_plus:function(e,t,n){return{operator:r.MathOperator.Add,left:e.asMarsJSObject(),right:n.asMarsJSObject()}},AddExp_minus:function(e,t,n){return{operator:r.MathOperator.Subtract,left:e.asMarsJSObject(),right:n.asMarsJSObject()}},MulExp_times:function(e,t,n){return{operator:r.MathOperator.Multiply,left:e.asMarsJSObject(),right:n.asMarsJSObject()}},MulExp_divide:function(e,t,n){return{operator:r.MathOperator.Divide,left:e.asMarsJSObject(),right:n.asMarsJSObject()}},operandLiteral:function(e){return e.asMarsJSObject()},opcode:function(e){return r.Opcode[e.sourceString.toUpperCase()]},number:function(e,t){return parseInt(""+e.sourceString+t.sourceString)},label:function(e){return e.sourceString},comment:function(e,t){return t.sourceString}})},9:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}(n(18));var r=n(42);t.parse=r.parse;var i=n(12);t.VM=i.VM},98:function(e,t,n){},99:function(e,t,n){}},[[35,1,2]]]);
//# sourceMappingURL=main.9a1b9ab3.chunk.js.map